# **مستندات کلاس `CalendarConverter.php`**

### **۱. دید کلی**

کلاس `CalendarConverter.php` یک کتابخانه حرفه‌ای و مستقل به زبان PHP است که برای تبدیل تاریخ با دقت بالا بین سیستم‌های تقویمی مختلف طراحی شده است. این کلاس به عنوان هسته محاسباتی و موتور اصلی برنامه عمل می‌کند.

این کلاس از تقویم‌های زیر پشتیبانی می‌کند:

  * **میلادی (Gregorian)**: تقویم استاندارد بین‌المللی.
  * **قمری (Islamic/Lunar Hijri)**: بر اساس یک الگوریتم محاسباتی (حسابی) قابل اتکا.
  * **شمسی (Persian/Solar Hijri)**: با استفاده از یک الگوریتم دقیق و مدرن که نتایجی مطابق با تقویم رسمی ارائه می‌دهد.

منطق زیربنایی این کلاس، یک برگردان حرفه‌ای به زبان PHP از الگوریتم‌های معتبر و تست‌شده است.

### **۲. مفاهیم بنیادین و نحوه کارکرد**

دقت و انعطاف‌پذیری این کلاس بر پایه دو اصل اساسی بنا شده است: استفاده از عدد روز ژولینی و پیاده‌سازی الگوریتم‌های معتبر.

#### **۲.۱. عدد روز ژولینی (Julian Day Number - JD)**

سنگ بنای تمام محاسبات در این کلاس، **عدد روز ژولینی** است. به جای ایجاد فرمول‌های پیچیده و مستعد خطا برای تبدیل مستقیم بین تقویم‌ها (مثلاً شمسی به قمری)، هر تبدیل به صورت یک فرآیند استاندارد دو مرحله‌ای انجام می‌شود:

1.  **تبدیل تاریخ به JD**: تاریخ مبدأ (مثلاً یک تاریخ میلادی) به عدد روز ژولینی معادل آن تبدیل می‌شود. JD یک شمارش پیوسته از روزها از یک مبدأ تاریخی ثابت در علم نجوم است.
2.  **تبدیل JD به تاریخ**: این عدد جهانی سپس به صورت ریاضی به سیستم تقویم مقصد تبدیل می‌شود.

این روش مانند یک "زبان مشترک" بین تقویم‌ها عمل کرده و تضمین می‌کند که تمام تبدیل‌ها از نظر ریاضی صحیح، قابل بازگشت و بسیار دقیق هستند.

#### **۲.۲. الگوریتم‌های پیاده‌سازی شده**

  * **تقویم شمسی**: الگوریتم استفاده شده برای تقویم شمسی، یک روش محاسباتی با دقت بسیار بالا است که بر اساس آفست روزهای سال و مدیریت دقیق سال‌های کبیسه عمل می‌کند. این روش به عنوان جایگزینی پایدار و دقیق برای محاسبات پیچیده نجومی انتخاب شده و نتایج آن با تقویم رسمی تطابق کامل دارد.
  * **تقویم قمری**: این یک تقویم محاسباتی است که بر اساس یک **چرخه ۳۰ ساله** با ۱۱ سال کبیسه از پیش تعیین‌شده کار می‌کند. این روش کاملاً قابل پیش‌بینی و استاندارد برای نرم‌افزارها است اما ممکن است یک یا دو روز با تقویم‌های استهِلالی (که به رؤیت هلال ماه بستگی دارند) اختلاف داشته باشد.

### **۳. نحوه استفاده**

برای استفاده از کلاس، کافی است فایل آن را فراخوانی کرده و یک نمونه جدید از آن بسازید.

```php
<?php

require_once 'CalendarConverter.php';

$converter = new CalendarConverter();

// مثال: تبدیل یک تاریخ میلادی به معادل شمسی آن
$greg_year = 2025;
$greg_month = 7;
$greg_day = 18;

list($p_year, $p_month, $p_day) = $converter->gregorianToPersian($greg_year, $greg_month, $g_day);

// خروجی مورد انتظار: Persian date: 1404 / 4 / 27
echo "Persian date: $p_year / $p_month / $p_day\n"; 

// مثال: بررسی کبیسه بودن یک سال شمسی
$is_leap = $converter->isLeapPersian(1403);

// خروجی مورد انتظار: Year 1403 is a leap year.
echo "Year 1403 is " . ($is_leap ? "a leap year." : "not a leap year.") . "\n";

?>
```

-----

### **۴. مرجع کامل توابع عمومی (Public API)**

این بخش تمام توابع عمومی قابل استفاده در کلاس `CalendarConverter` را تشریح می‌کند.

#### **توابع تقویم میلادی**

  * `public function isLeapGregorian(int $year): bool`

      * بررسی می‌کند که آیا سال میلادی مورد نظر کبیسه است یا خیر.
      * **@param** `$year` - سال میلادی.
      * **@return** `bool` - اگر کبیسه باشد `true` و در غیر این صورت `false`.

  * `public function gregorianToJd(int $year, int $month, int $day): float`

      * یک تاریخ میلادی را به عدد روز ژولینی معادل آن تبدیل می‌کند.
      * **@param** `$year`, `$month`, `$day` - اجزای تاریخ میلادی.
      * **@return** `float` - عدد روز ژولینی.

  * `public function jdToGregorian(float $jd): array`

      * یک عدد روز ژولینی را به تاریخ میلادی تبدیل می‌کند.
      * **@param** `$jd` - عدد روز ژولینی.
      * **@return** `array` - آرایه‌ای شامل `[سال, ماه, روز]`.

#### **توابع تقویم قمری**

  * `public function isLeapIslamic(int $year): bool`

      * بررسی می‌کند که آیا سال قمری مورد نظر کبیسه است یا خیر.
      * **@param** `$year` - سال قمری.
      * **@return** `bool`.

  * `public function islamicToJd(int $year, int $month, int $day): float`

      * یک تاریخ قمری را به عدد روز ژولینی معادل آن تبدیل می‌کند.
      * **@return** `float`.

  * `public function jdToIslamic(float $jd): array`

      * یک عدد روز ژولینی را به تاریخ قمری تبدیل می‌کند.
      * **@return** `array` - آرایه‌ای شامل `[سال, ماه, روز]`.

#### **توابع تقویم شمسی**

  * `public function isLeapPersian(int $pYear): bool`

      * بررسی می‌کند که آیا سال شمسی مورد نظر کبیسه است یا خیر.
      * **@param** `$pYear` - سال شمسی.
      * **@return** `bool`.

  * `public function persianToJd(int $pYear, int $pMonth, int $pDay): float`

      * یک تاریخ شمسی را به عدد روز ژولینی تبدیل می‌کند.
      * **@return** `float`.

  * `public function jdToPersian(float $jd): array`

      * یک عدد روز ژولینی را به تاریخ شمسی تبدیل می‌کند.
      * **@return** `array` - آرایه‌ای شامل `[سال, ماه, روز]`.

#### **توابع کمکی تبدیل مستقیم**

این توابع برای راحتی بیشتر فراهم شده‌اند و فرآیند دو مرحله‌ای تبدیل به JD و سپس به تاریخ مقصد را در یک فراخوانی کپسوله می‌کنند.

  * `gregorianToPersian(int $y, int $m, int $d): array`
  * `persianToGregorian(int $y, int $m, int $d): array`
  * `gregorianToIslamic(int $y, int $m, int $d): array`
  * `islamicToGregorian(int $y, int $m, int $d): array`
  * `persianToIslamic(int $y, int $m, int $d): array`
  * `islamicToPersian(int $y, int $m, int $d): array`

#### **توابع ابزاری**

  * `public function getWeekday(float $jd, string $locale = 'fa'): string`
      * نام روز هفته را برای یک عدد روز ژولینی مشخص برمی‌گرداند.
      * **@param** `$jd` - عدد روز ژولینی.
      * **@param** `$locale` - زبان خروجی ('fa' برای فارسی).
      * **@return** `string` - نام روز هفته.