# **مستندات کلاینت (Frontend) - فایل‌های JSX**

### **۱. دید کلی**

بخش کلاینت (Frontend) این پروژه به عنوان یک **اپلیکیشن تک‌صفحه‌ای (Single Page Application - SPA)** با استفاده از کتابخانه **React** و ابزار ساخت **Vite** توسعه داده شده است. این بخش مسئولیت کامل رندر کردن رابط کاربری، مدیریت تمام تعاملات کاربر، و برقراری ارتباط با بک‌اند PHP از طریق API را بر عهده دارد.

این رویکرد مدرن، تجربه‌ای سریع، پویا و بدون نیاز به بارگذاری مجدد صفحه را برای کاربر نهایی فراهم می‌کند.

### **۲. پشته فناوری و کتابخانه‌ها**

* **Vite**: ابزار ساخت (Build Tool) و سرور توسعه پروژه است که سرعت بسیار بالایی در بارگذاری و اعمال تغییرات (HMR) فراهم می‌کند.
* **React**: کتابخانه اصلی برای ساخت رابط کاربری است. تمام UI به صورت کامپوننت‌محور با React ساخته شده و وضعیت‌های مختلف برنامه (State) با استفاده از هوک‌هایی مانند `useState` و `useEffect` مدیریت می‌شوند.
* **React Multi-Date Picker**: یک کامپوننت React قدرتمند و یکپارچه که به عنوان انتخاب‌گر تاریخ اصلی پروژه عمل می‌کند. این کتابخانه به صورت داخلی از تقویم‌های مختلف (شمسی، میلادی، قمری) و زبان‌های متعدد (فارسی، عربی، انگلیسی) پشتیبانی می‌کند.
* **DateObject**: کتابخانه‌ای که به عنوان وابستگی `react-multi-date-picker` استفاده می‌شود و ابزارهای قدرتمندی برای ساخت، دستکاری و تبدیل آبجکت‌های تاریخ در سمت کلاینت فراهم می‌کند.
* **jQuery**: تنها برای مدیریت ساده رویداد `change` در منوی کشویی (select box) استفاده شده است.

### **۳. ساختار فایل‌ها**

* **`index.html`**: فایل ورودی اصلی برای مرورگر. این فایل شامل یک `<div>` با `id="root"` است که اپلیکیشن React در آن رندر می‌شود.
* **`src/main.jsx`**: نقطه ورود اصلی جاوا اسکریپت. این فایل مسئولیت مقداردهی اولیه React و رندر کردن کامپوننت اصلی (`App`) در `div#root` را بر عهده دارد. استایل‌های سراسری نیز در این فایل وارد (import) می‌شوند.
* **`src/App.jsx`**: کامپوننت اصلی و قلب تپنده فرانت‌اند. تمام منطق UI، مدیریت وضعیت، و توابع مربوط به تعاملات کاربر در این فایل قرار دارد.
* **`src/index.css` و `src/App.css`**: فایل‌های استایل CSS که به ترتیب برای استایل‌های سراسری (مانند `body`) و استایل‌های مخصوص کامپوننت `App` استفاده می‌شوند.

---
### **۴. جریان کار و منطق برنامه (Workflow)**

درک نحوه عملکرد فرانت‌اند به درک چگونگی مدیریت "وضعیت" (State) و "رویدادها" (Events) بستگی دارد.

#### **مدیریت وضعیت با `useState`**
در کامپوننت `App.jsx`، چندین متغیر وضعیت کلیدی تعریف شده است:
* `conversionType`: نوع تبدیل انتخاب شده توسط کاربر را نگهداری می‌کند (مثلاً: 'gregorian_to_persian').
* `date`: آبجکت تاریخ انتخاب شده توسط کاربر را نگهداری می‌کند. این آبجکت از نوع `DateObject` است.
* `result`: نتیجه دریافت شده از سرور پس از یک تبدیل موفق را نگهداری می‌کند.
* `loading`: وضعیت در حال پردازش بودن درخواست API را مشخص می‌کند (برای نمایش پیام "در حال تبدیل...").
* `error`: پیام خطا در صورت بروز مشکل در ارتباط با API را نگهداری می‌کند.

#### **تابع اصلی `renderDatePicker`**
این تابع، مسئول اصلی رندر کردن و به‌روزرسانی انتخاب‌گر تاریخ است.
1.  نوع تبدیل (`conversionType`) را به عنوان ورودی دریافت می‌کند.
2.  بر اساس ورودی، **آبجکت تقویم** (`persian`, `arabic`, `gregorian`) و **آبجکت زبان** (`persian_fa`, `arabic_ar`, `gregorian_en`) مناسب را از طریق تابع کمکی `getSourceCalendarProps` انتخاب می‌کند. این آبجکت‌ها از فایل‌هایی که از CDN بارگذاری شده‌اند، خوانده می‌شوند.
3.  یک **آبجکت تاریخ اولیه** (`initialDate`) بر اساس مقادیر موجود در فیلدهای مخفی (که توسط PHP یا رویداد `change` تنظیم شده‌اند) می‌سازد.
4.  یک آبجکت `props` (properties) برای کامپوننت `DatePicker` تعریف می‌کند. مهم‌ترین پراپرتی‌ها عبارتند از:
    * `calendar`: آبجکت تقویم را به کامپوننت پاس می‌دهد.
    * `locale`: آبجکت زبان را پاس می‌دهد که باعث تغییر خودکار زبان و چیدمان (RTL/LTR) می‌شود.
    * `value`: تاریخ اولیه را تنظیم می‌کند.
    * `onChange`: یک تابع callback که هر بار کاربر تاریخ را تغییر می‌دهد، اجرا شده و `state` برنامه را با تاریخ جدید به‌روزرسانی می‌کند.
5.  در نهایت، با استفاده از `ReactDOM.render()`، کامپوننت `DatePicker` را با پراپرتی‌های تعریف‌شده، در صفحه نمایش می‌دهد.

#### **رویداد `change` منوی کشویی**
این بخش، منطق هوشمند برنامه را پیاده‌سازی می‌کند:
1.  یک event listener به منوی کشویی متصل شده است.
2.  هرگاه کاربر نوع تبدیل را تغییر دهد، این تابع اجرا می‌شود.
3.  ابتدا تاریخ "امروز" را با استفاده از `new DateObject()` دریافت می‌کند.
4.  سپس تاریخ امروز را به سیستم تقویم **جدید** انتخاب شده تبدیل می‌کند (مثلاً اگر کاربر "قمری به میلادی" را انتخاب کند، تاریخ امروز به قمری تبدیل می‌شود).
5.  مقادیر فیلدهای مخفی را با این تاریخ جدید به‌روزرسانی می‌کند.
6.  در نهایت، تابع `renderDatePicker` را فراخوانی می‌کند تا انتخاب‌گر تاریخ با تقویم و زبان جدید دوباره رندر شود.

---
### **۵. تشریح کامپوننت اصلی (`App.jsx`)**

#### **تابع کمکی `getSourceCalendarProps`**
برای جلوگیری از تکرار کد، یک تابع کمکی تعریف شده که رشته `conversionType` را می‌گیرد و یک آبجکت شامل `{ calendar, locale }` صحیح را برمی‌گرداند. این تابع از یک `switch` case دقیق برای تطبیق نوع تبدیل با آبجکت‌های تقویم و زبان از پیش بارگذاری شده استفاده می‌کند.

#### **هوک `useEffect`**
این هوک به متغیر وضعیت `conversionType` گوش می‌دهد. هر زمان که این متغیر تغییر کند (یعنی کاربر گزینه جدیدی را در منوی کشویی انتخاب کند)، این هوک اجرا شده و دو کار انجام می‌دهد:
1.  تاریخ `state` را به "امروز" در سیستم تقویم جدید ریست می‌کند تا کاربر یک نقطه شروع منطقی داشته باشد.
2.  نتیجه تبدیل قبلی را پاک می‌کند.

#### **تابع `handleSubmit`**
این تابع مسئول ارسال درخواست به بک‌اند است:
1.  از رفرش شدن صفحه جلوگیری می‌کند.
2.  وضعیت `loading` را فعال می‌کند.
3.  با استفاده از `fetch` API، یک درخواست `POST` به `api.php` ارسال می‌کند. بدنه درخواست یک رشته JSON است که حاوی تاریخ و نوع تبدیل از `state` برنامه است.
4.  پس از دریافت پاسخ از سرور، آن را به فرمت JSON解析 کرده و بر اساس موفقیت‌آمیز بودن یا نبودن، `state` مربوط به `result` یا `error` را به‌روزرسانی می‌کند.
5.  در نهایت، وضعیت `loading` را غیرفعال می‌کند.

### **۶. نکات مهم پیاده‌سازی**

* **فیلدهای مخفی (`hidden inputs`)**: نقش این فیلدها، ایجاد یک پل ارتباطی برای مقداردهی اولیه بین PHP (که صفحه را برای اولین بار رندر می‌کند) و جاوا اسکریپت (که پس از آن کنترل را به دست می‌گیرد) است. در ادامه، تمام مدیریت وضعیت توسط React انجام می‌شود.
* **بارگذاری آبجکت‌های تقویم**: برخلاف تصور رایج، صرفاً پاس دادن یک رشته (مانند "persian") به کامپوننت کافی نیست. باید فایل‌های جاوا اسکریپت مربوط به هر تقویم و زبان از CDN بارگذاری شوند تا آبجکت‌های آن‌ها (مانند `persian`, `persian_fa`) در دسترس اسکریپت اصلی قرار گیرند.
* **حذف گزینه‌های اضافی**: در نسخه‌های نهایی، گزینه‌های مربوط به تقویم "حسابی" و "نجومی" شمسی حذف شده و با یک الگوریتم واحد و دقیق جایگزین شده‌اند تا از سردرگمی کاربر جلوگیری شود.